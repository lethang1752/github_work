--Create destination database (dbca)

--Create user with dba privileges in both "source" and "dest" db
/*
create user dbamgr identified by oracle123;
grant dba to dbamgr;
/*

--Check database size in Source DB 
/*
select
(select sum(bytes)/1024/1024/1024 data_size from dba_data_files) +
(select nvl(sum(bytes),0)/1024/1024/1024 temp_size from dba_temp_files) +
(select sum(bytes)/1024/1024/1024 redo_size from v$log) +
(select sum(BLOCK_SIZE*FILE_SIZE_BLKS)/1024/1024/1024 controlfile_size from v$controlfile) "Size in GB"
from dual;
*/

--Check object in SYSTEM, SYSAUX
/*
set lines 200
col USER format A20
col "SEGMENT NAME" format A30 
col TYPE format a20
SELECT OWNER "USER",SEGMENT_NAME "SEGMENT NAME",SEGMENT_TYPE "TYPE",BYTES/1024/1024 "SIZE_MB"
FROM DBA_SEGMENTS
WHERE TABLESPACE_NAME IN ('SYSTEM','SYSAUX') AND OWNER IN (
        SELECT USERNAME
        FROM DBA_USERS
        WHERE ACCOUNT_STATUS='OPEN' AND TRUNC(CREATED) > (
                SELECT TRUNC(CREATED)
                FROM DBA_USERS
                WHERE USERNAME='SYS'
            )
    ) AND OWNER NOT IN ('SYSMAN','ANONYMOUS','APEX_050100','APEX_PUBLIC_USER','APPQOSSYS','AUDSYS','CTXSYS','DBSFWUSER','DBSNMP','DIP','DVSYS','DVF','FLOWS_FILES','GGSYS','GSMADMIN_INTERNAL','GSMCATUSER','GSMUSER','LBACSYS','MDDATA','MDSYS','OUTLN','ORACLE_OCM','REMOTE_SCHEDULER_AGENT','SYSBACKUP','SYS$UMF','XDB','WMSYS','XS$NULL');
*/

--Create new tablespace with new datafile and mv above object to new tablespace
/*
sqlplus / as sysdba
create tablespace migrate_tbs datafile '?/dbs/migrate_tbs.dbf' size 100M autoextend on;
commit;
*****
select 'alter table '||owner||'.'||segment_name||' move tablespace migrate_tbs;' from dba_segments WHERE TABLESPACE_NAME IN ('SYSTEM','SYSAUX') AND OWNER IN (
        SELECT USERNAME
        FROM DBA_USERS
        WHERE ACCOUNT_STATUS='OPEN' AND TRUNC(CREATED) > (
                SELECT TRUNC(CREATED)
                FROM DBA_USERS
                WHERE USERNAME='SYS'
            )
    ) AND OWNER NOT IN ('SYSMAN','ANONYMOUS','APEX_050100','APEX_PUBLIC_USER','APPQOSSYS','AUDSYS','CTXSYS','DBSFWUSER','DBSNMP','DIP','DVSYS','DVF','FLOWS_FILES','GGSYS','GSMADMIN_INTERNAL','GSMCATUSER','GSMUSER','LBACSYS','MDDATA','MDSYS','OUTLN','ORACLE_OCM','REMOTE_SCHEDULER_AGENT','SYSBACKUP','SYS$UMF','XDB','WMSYS','XS$NULL');
-->

<--
*/

--Check datafile exclude from system, sysaux
--Compile invalid objects if any in Source
/*
@?/rdbms/admin/utlrp.sql 8
*/

--Check the invalid object count in Source
/*
select count(*) from dba_objects where status='INVALID';
*/

--Check estimate size of dumpfile
/*
expdp directory=MOM_DIR full=Y nologfile=Y estimate_only=Y
/*

--Export Roles & Privileges
/*
expdp directory=MOM_DIR dumpfile=WINDOWS_LINUX_ROLES.DMP logfile=WINDOWS_LINUX_ROLES.log full=Y INCLUDE=USER,ROLE,ROLE_GRANT,PROFILE
*/

--Export the database in full and exclude default schema
/*
expdp directory=MOM_DIR dumpfile=EXP_WINDOWS_LINUX_FULL.DMP logfile=EXP_WINDOWS_LINUX_FULL.log full=Y EXCLUDE=SCHEMA:\”IN \(\'ANONYMOUS\', \'APEX_030200\', \'APEX_PUBLIC_USER\', \'APPQOSSYS\', \'CTXSYS\', \'DBSNMP\', \'DIP\', \'EXFSYS\', \'FLOWS_FILES\', \'MDDATA\', \'MDSYS\', \'MGMT_VIEW\', \'OLAPSYS\', \'ORACLE_OCM\', \'ORDDATA\', \'ORDPLUGINS\', \'ORDSYS\', \'OUTLN\', \'OWBSYS\', \'OWBSYS_AUDIT\', \'SCOTT\', \'SI_INFORMTN_SCHEMA\', \'SPATIAL_CSW_ADMIN_USR\', \'SPATIAL_WFS_ADMIN_USR\', \'SYS\', \'SYSMAN\', \'SYSTEM\', \'WMSYS\', \'XDB\', \'XS$NULL\'\)\”
*/

--Create target db with same name with source db, create tablespace like source db in target db
/*

*/

--

